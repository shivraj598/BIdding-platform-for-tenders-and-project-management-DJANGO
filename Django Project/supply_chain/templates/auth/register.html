{% extends 'base.html' %}
{% load static %}

{% block title %}Leeds Supply Chain | Contractor Registration{% endblock %}

{% block content %}
<div class="min-h-screen bg-slate-50 py-12 px-4">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-dark-green rounded-2xl mb-4">
                <i data-lucide="user-plus" class="w-8 h-8 text-white"></i>
            </div>
            <h2 class="text-3xl font-extrabold text-dark-green">Contractor Registration</h2>
            <p class="mt-2 text-slate-600">Join our network to start bidding on public projects</p>
        </div>

        {% if user.is_authenticated %}
            <div class="bg-white p-8 rounded-2xl shadow-xl text-center">
                <div class="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="check-circle" class="w-10 h-10 text-dark-green"></i>
                </div>
                <h3 class="text-xl font-bold text-dark-green mb-2">Already Registered</h3>
                <p class="text-slate-600 mb-6">You are already logged in as <strong>{{ user.username }}</strong></p>
                <div class="space-y-3">
                    <a href="{% url 'home' %}" class="inline-block bg-dark-green text-white px-6 py-3 rounded-lg font-medium hover-bg-green">Go to Home</a>
                    <a href="{% url 'available_projects' %}" class="inline-block border border-dark-green text-dark-green px-6 py-3 rounded-lg font-medium hover:bg-emerald-50 ml-3">Browse Projects</a>
                </div>
            </div>
        {% else %}
            <!-- Registration Form -->
            <div class="bg-white p-8 rounded-2xl shadow-xl border border-slate-100">
                <form method="POST" action="{% url 'contractor_register' %}" enctype="multipart/form-data" class="space-y-6">
                    {% csrf_token %}
                    
                    {% if form.non_field_errors %}
                        <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl">
                            {% for error in form.non_field_errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <!-- Company Information -->
                    <div class="border-b border-slate-100 pb-6">
                        <h3 class="text-lg font-bold text-dark-green mb-4 flex items-center gap-2">
                            <i data-lucide="building" class="w-5 h-5"></i>
                            Company Information
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="{{ form.company_name.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-1">
                                    Company Name *
                                </label>
                                <input type="text" id="{{ form.company_name.id_for_label }}" name="company_name" required
                                       class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-dark-green outline-none"
                                       placeholder="Elite Construction Ltd">
                                {% if form.company_name.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.company_name.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label for="{{ form.license_number.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-1">
                                    Business License Number *
                                </label>
                                <input type="text" id="{{ form.license_number.id_for_label }}" name="license_number" required
                                       class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-dark-green outline-none"
                                       placeholder="LIC-123456">
                                {% if form.license_number.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.license_number.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <label for="{{ form.experience_years.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-1">
                                Years of Experience *
                            </label>
                            <input type="number" id="{{ form.experience_years.id_for_label }}" name="experience_years" required min="0"
                                   class="w-full md:w-1/3 px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-dark-green outline-none"
                                   placeholder="5">
                            {% if form.experience_years.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.experience_years.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Personal Information -->
                    <div class="border-b border-slate-100 pb-6">
                        <h3 class="text-lg font-bold text-dark-green mb-4 flex items-center gap-2">
                            <i data-lucide="user" class="w-5 h-5"></i>
                            Personal Information
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-1">
                                    First Name *
                                </label>
                                <input type="text" id="{{ form.first_name.id_for_label }}" name="first_name" required
                                       class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-dark-green outline-none"
                                       placeholder="John">
                                {% if form.first_name.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.first_name.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-1">
                                    Last Name *
                                </label>
                                <input type="text" id="{{ form.last_name.id_for_label }}" name="last_name" required
                                       class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-dark-green outline-none"
                                       placeholder="Doe">
                                {% if form.last_name.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.last_name.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div>
                                <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-1">
                                    Email Address *
                                </label>
                                <input type="email" id="{{ form.email.id_for_label }}" name="email" required
                                       class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-dark-green outline-none"
                                       placeholder="john@company.com">
                                {% if form.email.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.email.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label for="{{ form.phone.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-1">
                                    Phone Number *
                                </label>
                                <input type="tel" id="{{ form.phone.id_for_label }}" name="phone" required
                                       class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-dark-green outline-none"
                                       placeholder="+1 (555) 123-4567">
                                {% if form.phone.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.phone.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Account Credentials -->
                    <div class="border-b border-slate-100 pb-6">
                        <h3 class="text-lg font-bold text-dark-green mb-4 flex items-center gap-2">
                            <i data-lucide="lock" class="w-5 h-5"></i>
                            Account Credentials
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="{{ form.username.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-1">
                                    Username *
                                </label>
                                <input type="text" id="{{ form.username.id_for_label }}" name="username" required
                                       class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-dark-green outline-none"
                                       placeholder="johndoe_construction">
                                {% if form.username.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.username.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div>
                                <label for="{{ form.password1.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-1">
                                    Password *
                                </label>
                                <input type="password" id="{{ form.password1.id_for_label }}" name="password1" required
                                       class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-dark-green outline-none"
                                       placeholder="••••••••">
                                {% if form.password1.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.password1.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label for="{{ form.password2.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-1">
                                    Confirm Password *
                                </label>
                                <input type="password" id="{{ form.password2.id_for_label }}" name="password2" required
                                       class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-dark-green outline-none"
                                       placeholder="••••••••">
                                {% if form.password2.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.password2.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Documents -->
                    <div class="pb-6">
                        <h3 class="text-lg font-bold text-dark-green mb-4 flex items-center gap-2">
                            <i data-lucide="file-text" class="w-5 h-5"></i>
                            Documents
                        </h3>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-1">
                                Business License Document
                            </label>
                            <div class="border-2 border-dashed border-slate-200 rounded-xl p-6 text-center cursor-pointer hover:bg-slate-50 transition"
                                 onclick="document.getElementById('license_document').click()">
                                <i data-lucide="upload-cloud" class="w-8 h-8 mx-auto text-slate-400 mb-2"></i>
                                <p class="text-sm text-slate-600 mb-1">Click to upload license (PDF, JPG, PNG)</p>
                                <p class="text-xs text-slate-500">Max file size: 5MB</p>
                            </div>
                            <input type="file" id="license_document" name="license_document" accept=".pdf,.jpg,.jpeg,.png"
                                   class="hidden" onchange="updateFileName('license_document', 'license-file-name')">
                            <p id="license-file-name" class="text-xs text-slate-500 mt-2"></p>
                            {% if form.license_document.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.license_document.errors.0 }}</p>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">
                                Company Address
                            </label>
                            <textarea id="{{ form.address.id_for_label }}" name="address" rows="3"
                                      class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-dark-green outline-none"
                                      placeholder="123 Business Street, City, State, ZIP Code"></textarea>
                            {% if form.address.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.address.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Terms and Submit -->
                    <div>
                        <label class="flex items-start gap-2 text-sm text-slate-600">
                            <input type="checkbox" required class="mt-1 rounded border-slate-300 text-dark-green focus:ring-dark-green">
                            <span>I agree to the <a href="#" class="text-dark-green hover:underline">Terms of Service</a> and <a href="#" class="text-dark-green hover:underline">Privacy Policy</a></span>
                        </label>
                        
                        <button type="submit" 
                                class="w-full mt-6 bg-dark-green text-white py-4 rounded-xl font-bold hover-bg-green shadow-lg transition-all">
                            Create Contractor Account
                        </button>
                    </div>
                </form>
                
                <div class="mt-6 pt-6 border-t border-slate-100 text-center">
                    <p class="text-sm text-slate-600">
                        Already have an account? 
                        <a href="{% url 'login' %}" class="text-dark-green font-bold hover:underline">Sign In</a>
                    </p>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<script>
    function updateFileName(inputId, displayId) {
        const input = document.getElementById(inputId);
        const display = document.getElementById(displayId);
        if (input.files.length > 0) {
            display.textContent = 'Selected file: ' + input.files[0].name;
            display.className = 'text-xs text-dark-green font-medium mt-2';
        }
    }
    
    // Initialize form validation
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        if (form) {
            form.addEventListener('submit', function(e) {
                const password1 = document.getElementById('{{ form.password1.id_for_label }}');
                const password2 = document.getElementById('{{ form.password2.id_for_label }}');
                
                if (password1 && password2 && password1.value !== password2.value) {
                    e.preventDefault();
                    alert('Passwords do not match!');
                    password2.focus();
                }
            });
        }
    });
</script>
{% endblock %}