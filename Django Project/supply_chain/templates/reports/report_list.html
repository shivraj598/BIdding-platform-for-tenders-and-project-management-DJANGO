{% extends 'base.html' %}
{% load static %}

{% block title %}Leeds Supply Chain  | Reports{% endblock %}

{% block content %}
<div class="flex min-h-screen bg-slate-50">
    {% if user.user_type == 'council' %}
        {% include 'includes/council_sidebar.html' %}
    {% endif %}
    
    <div class="flex-1">
        <!-- Header -->
        <div class="bg-white border-b border-slate-200">
            <div class="max-w-7xl mx-auto px-4 py-8">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                    <div>
                        <div class="flex items-center gap-3 mb-3">
                            <a href="{% url 'council_dashboard' %}" class="text-slate-600 hover:text-dark-green transition">
                                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                            </a>
                            <h1 class="text-3xl font-bold text-slate-800">Reports & Analytics</h1>
                        </div>
                        <p class="text-slate-600 mt-2">Generate insights and reports for better decision making</p>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="flex flex-wrap gap-3">
                        <a href="{% url 'report_create' %}" 
                           class="bg-dark-green text-white px-4 py-3 rounded-xl font-medium hover-bg-green flex items-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Create Report
                    </a>
                    {% if user.user_type == 'council' %}
                    <a href="{% url 'auto_generate_report' %}" 
                       class="bg-purple-600 text-white px-4 py-3 rounded-xl font-medium hover:bg-purple-700 flex items-center gap-2">
                        <i data-lucide="zap" class="w-4 h-4"></i>
                        Auto Generate Report
                    </a>
                    {% endif %}
                    <a href="{% url 'bid_analytics' %}" 
                       class="bg-emerald-600 text-white px-4 py-3 rounded-xl font-medium hover:bg-emerald-700 flex items-center gap-2">
                        <i data-lucide="bar-chart" class="w-4 h-4"></i>
                        View Analytics
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Types -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="bg-emerald-100 p-3 rounded-lg">
                        <i data-lucide="trending-up" class="w-6 h-6 text-dark-green"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-800">Project Progress</h3>
                        <p class="text-sm text-slate-600">{{ progress_reports.count }} reports</p>
                    </div>
                </div>
                <p class="text-slate-600 text-sm mb-4">Track project milestones, completion rates, and team performance</p>
                <a href="?type=progress" class="text-dark-green hover:underline font-medium text-sm">
                    View Progress Reports →
                </a>
            </div>
            
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="bg-blue-100 p-3 rounded-lg">
                        <i data-lucide="dollar-sign" class="w-6 h-6 text-blue-600"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-800">Financial Analysis</h3>
                        <p class="text-sm text-slate-600">{{ financial_reports.count }} reports</p>
                    </div>
                </div>
                <p class="text-slate-600 text-sm mb-4">Budget tracking, cost analysis, and financial performance metrics</p>
                <a href="?type=financial" class="text-dark-green hover:underline font-medium text-sm">
                    View Financial Reports →
                </a>
            </div>
            
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="bg-amber-100 p-3 rounded-lg">
                        <i data-lucide="clipboard-check" class="w-6 h-6 text-amber-600"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-800">Quality & Safety</h3>
                        <p class="text-sm text-slate-600">{{ quality_reports.count }} reports</p>
                    </div>
                </div>
                <p class="text-slate-600 text-sm mb-4">Quality inspections, safety audits, and compliance reports</p>
                <a href="?type=quality" class="text-dark-green hover:underline font-medium text-sm">
                    View Quality Reports →
                </a>
            </div>
        </div>

        <!-- Reports List -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                <h2 class="text-xl font-bold text-slate-800">Recent Reports</h2>
                <div class="flex gap-3">
                    <select class="px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-dark-green outline-none bg-white">
                        <option>All Projects</option>
                        {% for project in projects %}
                            <option>{{ project.title|truncatechars:30 }}</option>
                        {% endfor %}
                    </select>
                    <select class="px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-dark-green outline-none bg-white">
                        <option>All Types</option>
                        <option>Progress</option>
                        <option>Financial</option>
                        <option>Quality</option>
                        <option>Safety</option>
                        <option>Completion</option>
                    </select>
                </div>
            </div>
            
            <div class="divide-y divide-slate-100">
                {% for report in reports %}
                <div class="p-6 hover:bg-slate-50 transition">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4">
                        <div>
                            <h3 class="font-bold text-slate-800 mb-1">{{ report.title }}</h3>
                            <div class="flex items-center gap-4 text-sm text-slate-600">
                                <span class="flex items-center gap-1">
                                    <i data-lucide="folder" class="w-4 h-4"></i>
                                    {{ report.project.title|truncatechars:30 }}
                                </span>
                                <span class="flex items-center gap-1">
                                    <i data-lucide="calendar" class="w-4 h-4"></i>
                                    {{ report.created_at|date:"M d, Y" }}
                                </span>
                                <span class="px-2 py-1 rounded text-xs font-medium 
                                    {% if report.report_type == 'progress' %}bg-emerald-100 text-emerald-800
                                    {% elif report.report_type == 'financial' %}bg-blue-100 text-blue-800
                                    {% elif report.report_type == 'quality' %}bg-amber-100 text-amber-800
                                    {% elif report.report_type == 'safety' %}bg-red-100 text-red-800
                                    {% else %}bg-purple-100 text-purple-800{% endif %}">
                                    {{ report.get_report_type_display }}
                                </span>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            {% if report.document %}
                            <a href="{{ report.document.url }}" target="_blank" 
                               class="text-dark-green hover:underline flex items-center gap-1">
                                <i data-lucide="file-text" class="w-4 h-4"></i>
                                Document
                            </a>
                            {% endif %}
                            <a href="{% url 'report_pdf' report.id %}" 
                               class="bg-red-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-red-700 text-sm flex items-center gap-2">
                                <i data-lucide="download" class="w-4 h-4"></i>
                                Download PDF
                            </a>
                        </div>
                    </div>
                    
                    <p class="text-slate-600 text-sm mb-4 line-clamp-2">{{ report.content|truncatechars:200 }}</p>
                    
                    <div class="flex justify-between items-center text-sm text-slate-500">
                        <span>Created by {{ report.created_by.username }}</span>
                        <div class="flex gap-3">
                            <a href="{% url 'report_update' report.id %}" class="text-dark-green hover:underline">Edit</a>
                            <a href="{% url 'report_delete' report.id %}" 
                               class="text-red-600 hover:text-red-800"
                               onclick="return confirm('Delete this report?')">Delete</a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="p-12 text-center">
                    <i data-lucide="file-text" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i>
                    <h3 class="text-lg font-bold text-slate-700 mb-2">No Reports Yet</h3>
                    <p class="text-slate-600 mb-6">Create your first report to track project progress and performance</p>
                    <a href="{% url 'report_create' %}" 
                       class="inline-block bg-dark-green text-white px-6 py-3 rounded-xl font-medium hover-bg-green">
                        Create First Report
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
    </div>
</div>
{% endblock %}